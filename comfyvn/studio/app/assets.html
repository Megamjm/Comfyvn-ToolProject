<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Assets</title>
  <style>
    body{font-family:system-ui,Arial,sans-serif;margin:1rem}
    table{border-collapse:collapse;width:100%} td,th{border:1px solid #ccc;padding:.4rem}
    .row{display:flex;gap:.5rem;align-items:center;margin-bottom:.75rem}
  </style>
</head>
<body>
  <h2>Assets</h2>
  <div class="row">
    <input id="file" type="file"/>
    <button id="up">Upload</button>
    <button id="refresh">Refresh</button>
  </div>
  <table>
    <thead><tr><th>Key</th><th>Preview</th><th>Actions</th></tr></thead>
    <tbody id="tb"></tbody>
  </table>
<script>
const tb=document.getElementById("tb");
async function list(){
  const r=await fetch("/asset-store/list"); const j=await r.json();
  tb.innerHTML="";
  for(const k of j.items){
    const url="/asset-store/static/"+encodeURIComponent(k);
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${k}</td><td><img src="${url}" height="48" onerror="this.remove()"/></td>
      <td><a href="${url}" target="_blank">open</a></td>`;
    tb.appendChild(tr);
  }
}
document.getElementById("refresh").onclick=list;
document.getElementById("up").onclick=async()=>{
  const f=document.getElementById("file").files[0];
  if(!f) return;
  const fd=new FormData(); fd.append("file", f);
  const r=await fetch("/asset-store/upload",{method:"POST",body:fd});
  alert(await r.text()); list();
};
list();
</script>
</body>
</html>
