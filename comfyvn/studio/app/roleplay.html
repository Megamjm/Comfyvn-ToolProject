<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Roleplay Import / Mass Edit</title>
  <style>
    body{font-family:system-ui,Arial,sans-serif;margin:1rem}
    textarea{width:100%;height:200px}
    pre{background:#111;color:#eee;padding:.6rem;max-height:50vh;overflow:auto}
    .row{display:flex;gap:.5rem;align-items:center;margin:.5rem 0}
    .inp{padding:.35rem .5rem;border:1px solid #bbb;border-radius:.3rem}
    .pill{padding:.35rem .6rem;border:1px solid #bbb;border-radius:.4rem;background:#f7f7f7;cursor:pointer}
  </style>
</head>
<body>
  <h2>Roleplay</h2>

  <div class="row">
    <input id="scene" class="inp" placeholder="scene id" value="dev"/>
    <button id="list" class="pill">List Scenes</button>
    <button id="load" class="pill">Load</button>
  </div>

  <h3>Import Transcript</h3>
  <textarea id="tx" placeholder="Paste lines like:  Alice: Hello there"></textarea>
  <div class="row">
    <button id="imp" class="pill">Import</button>
  </div>

  <h3>Mass Edit</h3>
  <div class="row">
    <input id="op" class="inp" style="width:220px" value='{"op":"rename_speaker","from":"Alice","to":"A"}'/>
    <button id="apply" class="pill">Apply</button>
  </div>

  <h3>Scene</h3>
  <pre id="out">ready</pre>

<script>
const out=document.getElementById("out");
const scene=()=>document.getElementById("scene").value.trim()||"dev";

document.getElementById("list").onclick=async()=>{
  const r=await fetch("/roleplay/scenes"); out.textContent=JSON.stringify(await r.json(),null,2);
};
document.getElementById("load").onclick=async()=>{
  const r=await fetch("/roleplay/scene?scene_id="+encodeURIComponent(scene()));
  out.textContent=JSON.stringify(await r.json(),null,2);
};
document.getElementById("imp").onclick=async()=>{
  const body={scene_id: scene(), transcript: document.getElementById("tx").value};
  const r=await fetch("/roleplay/import",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(body)});
  out.textContent=JSON.stringify(await r.json(),null,2);
};
document.getElementById("apply").onclick=async()=>{
  try{
    const op = JSON.parse(document.getElementById("op").value);
    const r=await fetch("/roleplay/mass-edit",{method:"POST",headers:{"Content-Type":"application/json"},
      body: JSON.stringify({scene_id: scene(), ops:[op]})});
    out.textContent=JSON.stringify(await r.json(),null,2);
  }catch(e){ out.textContent=String(e); }
};
</script>
</body>
</html>
